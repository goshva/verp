{{ define "dashboard_page.html" }}
{{ template "base.html" . }}
{{ end }}

{{ define "content" }}
<div class="page-header">
    <h1>üìä –î–∞—à–±–æ—Ä–¥</h1>
    <p class="page-subtitle">–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã</p>
</div>

<!-- –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div class="card">
    <h2 style="margin-bottom: 1.5rem;">üìà –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–æ–≤ -->

        {{ template "machines_chart.html" . }}
        {{template "operations_chart.html" .}}
        {{ template "cash_chart.html" . }}

        <div class="stat-card">
            <div class="stat-icon">üü¢</div>
            <div class="stat-value">{{.ActiveMachines}}</div>
            <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö –∞–≤—Ç–æ–º–∞—Ç–æ–≤</div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">üé™</div>
            <div class="stat-value">{{.TotalToys}}</div>
            <div class="stat-label">–ò–≥—Ä—É—à–µ–∫ –≤ –∞–≤—Ç–æ–º–∞—Ç–∞—Ö</div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">üîÑ</div>
            <div class="stat-value">{{.RestockOperations}}</div>
            <div class="stat-label">–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–π</div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">üíµ</div>
            <div class="stat-value">{{.CollectionOperations}}</div>
            <div class="stat-label">–ò–Ω–∫–∞—Å—Å–∞—Ü–∏–π</div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">üîß</div>
            <div class="stat-value">{{.MaintenanceOperations}}</div>
            <div class="stat-label">–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–π</div>
        </div>
    </div>
</div>

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∫–ª–∞–¥–æ–≤ -->
<div class="card">
    <h2 style="margin-bottom: 1.5rem;">üè≠ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∫–ª–∞–¥–æ–≤</h2>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
        <div class="stat-card">
            <div class="stat-icon">üí∞</div>
            <div class="stat-value">{{.TotalValue}}</div>
            <div class="stat-label">–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è</div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">‚ö†Ô∏è</div>
            <div class="stat-value">{{.LowStockCount}}</div>
            <div class="stat-label">–ü–æ–∑–∏—Ü–∏–π —Å –Ω–∏–∑–∫–∏–º –∑–∞–ø–∞—Å–æ–º</div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">‚ùå</div>
            <div class="stat-value">{{.OutOfStockCount}}</div>
            <div class="stat-label">–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–∑–∏—Ü–∏–π</div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">üè≠</div>
            <div class="stat-value">{{.TotalWarehouses}}</div>
            <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö —Å–∫–ª–∞–¥–æ–≤</div>
        </div>
    </div>
</div>

<!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-top: 1.5rem;">
    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º —Ç–æ–≤–∞—Ä–æ–≤ -->
    <div class="card">
        <h3>üì¶ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ç–∏–ø–∞–º</h3>
        <div style="margin-top: 1rem;">
            {{range .InventoryByType}}
            <div
                style="display: flex; justify-content: between; align-items: center; margin-bottom: 0.75rem; padding: 0.5rem; border-radius: 6px;">
                <span style="font-weight: 500;">{{.TypeName}}</span>
                <span style="font-weight: 600; color: var(--primary);">{{.Count}} –µ–¥.</span>
            </div>
            {{end}}
        </div>
    </div>

    <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
    <div class="card">
        <h3>‚ö° –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
        <div style="margin-top: 1rem; display: flex; flex-direction: column; gap: 0.75rem;">
            <button class="btn btn-primary" hx-get="/warehouses/inventory-form" hx-target="#modal-body"
                onclick="VendERP.showModal()">
                üì¶ –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
            </button>
            <button class="btn btn-secondary" hx-get="/warehouses/form" hx-target="#modal-body"
                onclick="VendERP.showModal()">
                üè≠ –î–æ–±–∞–≤–∏—Ç—å —Å–∫–ª–∞–¥
            </button>
            <button class="btn btn-warning" hx-get="/operations/form" hx-target="#modal-body"
                onclick="VendERP.showModal()">
                üìã –ù–æ–≤–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
            </button>
        </div>
    </div>
</div>

<!-- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–∑–∏—Ü–∏–∏ -->
{{if .LowStockItems}}
<div class="card" style="margin-top: 1.5rem;">
    <h3>üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–∑–∏—Ü–∏–∏</h3>
    <div style="margin-top: 1rem;">
        {{range .LowStockItems}}
        <div
            style="display: flex; justify-content: between; align-items: center; margin-bottom: 0.5rem; padding: 0.75rem; background: rgba(255, 193, 7, 0.1); border-left: 4px solid var(--warning); border-radius: 4px;">
            <div>
                <div style="font-weight: 500;">{{.ItemName}}</div>
                <div style="font-size: 0.75rem; color: var(--text-secondary);">{{.WarehouseName}}</div>
            </div>
            <div style="text-align: right;">
                <div style="font-weight: 600; color: var(--warning);">{{.Quantity}}/{{.MinStockLevel}}</div>
                <div style="font-size: 0.75rem; color: var(--text-secondary);">–æ—Å—Ç–∞–ª–æ—Å—å</div>
            </div>
        </div>
        {{end}}
    </div>
</div>
{{end}}


<!-- –î–æ–±–∞–≤—å—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω–æ –≤ dashboard_page.html –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // –¢–µ—Å—Ç–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ API
    async function testCashApi() {
        try {
            console.log('Testing /api/charts/cash endpoint...');
            const response = await fetch('/api/charts/cash');
            console.log('Response status:', response.status);
            if (response.ok) {
                const data = await response.json();
                console.log('Cash chart data:', data);
                return true;
            } else {
                console.error('API error:', response.status, response.statusText);
                return false;
            }
        } catch (error) {
            console.error('Fetch error:', error);
            return false;
        }
    }
    
    // –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
    setTimeout(() => {
        testCashApi().then(success => {
            console.log('Cash API test:', success ? 'SUCCESS' : 'FAILED');
        });
    }, 2000);
});
</script>
{{ end }}