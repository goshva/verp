{{ define "dashboard_page.html" }}
{{ template "base.html" . }}
{{ end }}

{{ define "content" }}
<div class="page-header">
    <h1>üìä –î–∞—à–±–æ—Ä–¥</h1>
    <p class="page-subtitle">–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã</p>
</div>

<!-- –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div class="card">
    <h2 style="margin-bottom: 1.5rem;">üìà –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
        <!-- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –≥—Ä–∞—Ñ–∏–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–æ–≤ -->
        {{ if .ChartData }}
        {{ template "machines_chart.html" . }}
        {{ else }}
        <!-- Fallback: –ø—Ä–æ—Å—Ç–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ -->
        <div class="stat-card">
            <div class="stat-icon">ü§ñ</div>
            <div class="stat-value">{{.TotalMachines}}</div>
            <div class="stat-label">–í—Å–µ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–æ–≤</div>
        </div>
        {{ end }}
        
        <!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ -->
        <div class="stat-card">
            <div class="stat-icon">üü¢</div>
            <div class="stat-value">{{.ActiveMachines}}</div>
            <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö –∞–≤—Ç–æ–º–∞—Ç–æ–≤</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">üí∞</div>
            <div class="stat-value">{{.TotalCash}}</div>
            <div class="stat-label">–û–±—â–∞—è —Å—É–º–º–∞ –≤ –∞–≤—Ç–æ–º–∞—Ç–∞—Ö</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">üé™</div>
            <div class="stat-value">{{.TotalToys}}</div>
            <div class="stat-label">–ò–≥—Ä—É—à–µ–∫ –≤ –∞–≤—Ç–æ–º–∞—Ç–∞—Ö</div>
        </div>
        
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–π -->
        <div class="stat-card">
            <div class="stat-icon">üìã</div>
            <div class="stat-value">{{.TotalOperations}}</div>
            <div class="stat-label">–í—Å–µ–≥–æ –æ–ø–µ—Ä–∞—Ü–∏–π</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">üîÑ</div>
            <div class="stat-value">{{.RestockOperations}}</div>
            <div class="stat-label">–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–π</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">üíµ</div>
            <div class="stat-value">{{.CollectionOperations}}</div>
            <div class="stat-label">–ò–Ω–∫–∞—Å—Å–∞—Ü–∏–π</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">üîß</div>
            <div class="stat-value">{{.MaintenanceOperations}}</div>
            <div class="stat-label">–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–π</div>
        </div>
    </div>
</div>

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∫–ª–∞–¥–æ–≤ -->
<div class="card">
    <h2 style="margin-bottom: 1.5rem;">üè≠ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∫–ª–∞–¥–æ–≤</h2>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
        <div class="stat-card">
            <div class="stat-icon">üí∞</div>
            <div class="stat-value">{{.TotalValue}}</div>
            <div class="stat-label">–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">‚ö†Ô∏è</div>
            <div class="stat-value">{{.LowStockCount}}</div>
            <div class="stat-label">–ü–æ–∑–∏—Ü–∏–π —Å –Ω–∏–∑–∫–∏–º –∑–∞–ø–∞—Å–æ–º</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">‚ùå</div>
            <div class="stat-value">{{.OutOfStockCount}}</div>
            <div class="stat-label">–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–∑–∏—Ü–∏–π</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">üè≠</div>
            <div class="stat-value">{{.TotalWarehouses}}</div>
            <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö —Å–∫–ª–∞–¥–æ–≤</div>
        </div>
    </div>
</div>

<!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-top: 1.5rem;">
    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º —Ç–æ–≤–∞—Ä–æ–≤ -->
    <div class="card">
        <h3>üì¶ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ç–∏–ø–∞–º</h3>
        <div style="margin-top: 1rem;">
            {{range .InventoryByType}}
            <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 0.75rem; padding: 0.5rem; border-radius: 6px;">
                <span style="font-weight: 500;">{{.TypeName}}</span>
                <span style="font-weight: 600; color: var(--primary);">{{.Count}} –µ–¥.</span>
            </div>
            {{end}}
        </div>
    </div>

    <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
    <div class="card">
        <h3>‚ö° –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
        <div style="margin-top: 1rem; display: flex; flex-direction: column; gap: 0.75rem;">
            <button class="btn btn-primary" 
                    hx-get="/warehouses/inventory-form" 
                    hx-target="#modal-body"
                    onclick="VendERP.showModal()">
                üì¶ –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
            </button>
            <button class="btn btn-secondary" 
                    hx-get="/warehouses/form" 
                    hx-target="#modal-body"
                    onclick="VendERP.showModal()">
                üè≠ –î–æ–±–∞–≤–∏—Ç—å —Å–∫–ª–∞–¥
            </button>
            <button class="btn btn-warning" 
                    hx-get="/operations/form" 
                    hx-target="#modal-body"
                    onclick="VendERP.showModal()">
                üìã –ù–æ–≤–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
            </button>
        </div>
    </div>
</div>

<!-- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–∑–∏—Ü–∏–∏ -->
{{if .LowStockItems}}
<div class="card" style="margin-top: 1.5rem;">
    <h3>üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–∑–∏—Ü–∏–∏</h3>
    <div style="margin-top: 1rem;">
        {{range .LowStockItems}}
        <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 0.5rem; padding: 0.75rem; background: rgba(255, 193, 7, 0.1); border-left: 4px solid var(--warning); border-radius: 4px;">
            <div>
                <div style="font-weight: 500;">{{.ItemName}}</div>
                <div style="font-size: 0.75rem; color: var(--text-secondary);">{{.WarehouseName}}</div>
            </div>
            <div style="text-align: right;">
                <div style="font-weight: 600; color: var(--warning);">{{.Quantity}}/{{.MinStockLevel}}</div>
                <div style="font-size: 0.75rem; color: var(--text-secondary);">–æ—Å—Ç–∞–ª–æ—Å—å</div>
            </div>
        </div>
        {{end}}
    </div>
</div>
{{end}}

<style>
.stat-card {
    text-align: center;
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
    border: 1px solid var(--border-color);
}

.stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.stat-icon {
    font-size: 2rem;
    margin-bottom: 0.5rem;
}

.stat-value {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 0.5rem;
    line-height: 1;
}

.stat-label {
    font-size: 0.875rem;
    color: var(--text-secondary);
    font-weight: 500;
}

.page-subtitle {
    color: var(--text-secondary);
    margin-top: 0.5rem;
    font-size: 1.1rem;
}

.card {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    border: 1px solid var(--border-color);
    margin-bottom: 1.5rem;
}

.page-header {
    margin-bottom: 2rem;
}

.page-header h1 {
    font-size: 2rem;
    font-weight: 700;
    margin: 0;
}

.btn {
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    border: none;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-primary {
    background: var(--primary);
    color: white;
}

.btn-primary:hover {
    background: var(--primary-dark);
}

.btn-secondary {
    background: var(--secondary);
    color: white;
}

.btn-secondary:hover {
    background: var(--secondary-dark);
}

.btn-warning {
    background: var(--warning);
    color: white;
}

.btn-warning:hover {
    background: var(--warning-dark);
}
</style>
{{ end }}