{{ define "warehouses_page.html" }}
{{ template "base.html" . }}
{{ end }}

{{ define "content" }}
<div class="page-header">
    <h1>üè≠ –°–∫–ª–∞–¥—ã</h1>
    <div style="display: flex; gap: 1rem; align-items: center;">
        <button class="btn btn-primary" 
                hx-get="/warehouses/form" 
                hx-target="#modal-body"
                onclick="VendERP.showModal()">
            ‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–∫–ª–∞–¥
        </button>
        <button class="btn btn-secondary" 
                hx-get="/warehouses/inventory-form" 
                hx-target="#modal-body"
                onclick="VendERP.showModal()">
            üì¶ –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
        </button>
    </div>
</div>

<!-- –§–∏–ª—å—Ç—Ä—ã –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div class="card" style="margin-bottom: 1.5rem;">
    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
        <div style="display: flex; gap: 1rem; align-items: center;">
            <select id="warehouse-filter" class="form-select" style="width: 200px;"
                    onchange="filterInventory()">
                <option value="">–í—Å–µ —Å–∫–ª–∞–¥—ã</option>
                {{range .Warehouses}}
                <option value="{{.ID}}">{{.Name}}</option>
                {{end}}
            </select>
            
            <select id="category-filter" class="form-select" style="width: 200px;"
                    onchange="filterInventory()">
                <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                <option value="vending_machine">–ê–≤—Ç–æ–º–∞—Ç—ã</option>
                <option value="toy">–ò–≥—Ä—É—à–∫–∏</option>
                <option value="capsule">–ö–∞–ø—Å—É–ª—ã</option>
            </select>
            
            <select id="stock-filter" class="form-select" style="width: 200px;"
                    onchange="filterInventory()">
                <option value="">–í—Å–µ –ø–æ–∑–∏—Ü–∏–∏</option>
                <option value="low">–ù–∏–∑–∫–∏–π –∑–∞–ø–∞—Å</option>
                <option value="out">–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</option>
                <option value="normal">–ù–æ—Ä–º–∞–ª—å–Ω—ã–π –∑–∞–ø–∞—Å</option>
            </select>
        </div>
        
        <div style="display: flex; gap: 0.5rem; font-size: 0.875rem; color: var(--text-secondary);">
            <span>üìä –í—Å–µ–≥–æ: <strong>{{.TotalItems}}</strong> –ø–æ–∑–∏—Ü–∏–π</span>
            <span>üè≠ –°–∫–ª–∞–¥–æ–≤: <strong>{{.TotalWarehouses}}</strong></span>
        </div>
    </div>
</div>

<!-- –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è -->
<div class="card">
    <div id="warehouses-table">
        {{ template "warehouses_list.html" . }}
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π -->
<div id="action-modal" class="modal">
    <div class="modal-content" style="max-width: 500px;">
        <button class="modal-close" onclick="VendERP.hideActionModal()">√ó</button>
        <div id="action-modal-body"></div>
    </div>
</div>

<script>
function filterInventory() {
    const warehouseId = document.getElementById('warehouse-filter').value;
    const category = document.getElementById('category-filter').value;
    const stock = document.getElementById('stock-filter').value;
    
    const url = `/warehouses/filter?warehouse_id=${warehouseId}&category=${category}&stock=${stock}`;
    
    htmx.ajax('GET', url, '#warehouses-table');
}

function showQuickAction(itemId, action) {
    const url = `/warehouses/quick-action?item_id=${itemId}&action=${action}`;
    htmx.ajax('GET', url, '#action-modal-body');
    document.getElementById('action-modal').style.display = 'block';
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è VendERP –µ—Å–ª–∏ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞
if (typeof VendERP === 'undefined') {
    var VendERP = {};
}

VendERP.hideActionModal = function() {
    document.getElementById('action-modal').style.display = 'none';
    document.getElementById('action-modal-body').innerHTML = '';
}

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
setInterval(() => {
    if (document.visibilityState === 'visible') {
        filterInventory();
    }
}, 30000);
</script>
{{ end }}