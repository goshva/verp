{{ define "warehouses_page.html" }}
{{ template "base.html" . }}
{{ end }}

{{ define "content" }}
<div class="page-header">
    <h1>üè≠ –°–∫–ª–∞–¥—ã</h1>
    <div  class="action-btn" >
        <button class="btn btn-primary" 
                hx-get="/warehouses/form" 
                hx-target="#modal-body"
                onclick="VendERP.showModal()">
            ‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–∫–ª–∞–¥
        </button>
        <button class="btn btn-secondary" 
                hx-get="/warehouses/inventory-form" 
                hx-target="#modal-body"
                onclick="VendERP.showModal()">
            üì¶ –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
        </button>
    </div>
</div>

<!-- –§–∏–ª—å—Ç—Ä—ã –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div class="card" style="margin-bottom: 1.5rem;">
    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
        <div class="filter-drop" >
            <select id="warehouse-filter" class="form-select" 
                    onchange="filterInventory()">
                <option value="">–í—Å–µ —Å–∫–ª–∞–¥—ã</option>
                {{range .Warehouses}}
                <option value="{{.ID}}">{{.Name}}</option>
                {{end}}
            </select>
            
            <select id="category-filter" class="form-select" 
                    onchange="filterInventory()">
                <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                <option value="vending_machine">–ê–≤—Ç–æ–º–∞—Ç—ã</option>
                <option value="toy">–ò–≥—Ä—É—à–∫–∏</option>
                <option value="capsule">–ö–∞–ø—Å—É–ª—ã</option>
            </select>
            
            <select id="stock-filter" class="form-select" 
                    onchange="filterInventory()">
                <option value="">–í—Å–µ –ø–æ–∑–∏—Ü–∏–∏</option>
                <option value="low">–ù–∏–∑–∫–∏–π –∑–∞–ø–∞—Å</option>
                <option value="out">–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</option>
                <option value="normal">–ù–æ—Ä–º–∞–ª—å–Ω—ã–π –∑–∞–ø–∞—Å</option>
            </select>
        </div>
        
        <div style="display: flex; gap: 0.5rem; font-size: 0.875rem; color: var(--text-secondary);">
            <span>üìä –í—Å–µ–≥–æ: <strong>{{.TotalItems}}</strong> –ø–æ–∑–∏—Ü–∏–π</span>
            <span>üè≠ –°–∫–ª–∞–¥–æ–≤: <strong>{{.TotalWarehouses}}</strong></span>
        </div>
    </div>
</div>

<div class="card">
    <div id="warehouses-table">
        {{ template "warehouses_list.html" . }}
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π 
<div id="action-modal" class="modal">
    <div class="modal-content" style="max-width: 500px;">
        <button class="modal-close" onclick="VendERP.hideActionModal()">√ó</button>
        <div id="action-modal-body"></div>
    </div>
</div>
-->

<script>
function filterInventory() {
    const warehouseId = document.getElementById('warehouse-filter').value;
    const category = document.getElementById('category-filter').value;
    const stock = document.getElementById('stock-filter').value;
    
    const url = `/warehouses/filter?warehouse_id=${warehouseId}&category=${category}&stock=${stock}`;
    
    htmx.ajax('GET', url, '#warehouses-table');
}

</script>
{{ end }}