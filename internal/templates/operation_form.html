{{ define "operation_form" }}
<form hx-post="/operations/save" hx-target="#operations-table" hx-swap="innerHTML">
    <input type="hidden" name="id" value="{{.Operation.ID}}">
    
    <div class="form-group">
        <label>Автомат *</label>
        <select name="machine_id" required class="form-select">
            <option value="">Выберите автомат</option>
            {{range .Machines}}
            <option value="{{.ID}}" {{if eq .ID $.Operation.MachineID}}selected{{end}}>{{.Model}} (ID: {{.ID}})</option>
            {{end}}
        </select>
    </div>
    
    <div class="form-group">
        <label>Тип операции *</label>
        <select name="operation_type" required class="form-select">
            <option value="restock" {{if eq .Operation.OperationType "restock"}}selected{{end}}>Пополнение</option>
            <option value="collection" {{if eq .Operation.OperationType "collection"}}selected{{end}}>Инкассация</option>
            <option value="maintenance" {{if eq .Operation.OperationType "maintenance"}}selected{{end}}>Обслуживание</option>
        </select>
    </div>
    
    <div class="form-group">
        <label>Исполнитель *</label>
        <select name="performed_by" required class="form-select">
            <option value="">Выберите пользователя</option>
            {{range .Users}}
            <option value="{{.ID}}" {{if eq .ID $.Operation.PerformedBy}}selected{{end}}>{{.Username}} {{if .FullUserName}}({{.FullUserName}}){{end}}</option>
            {{end}}
        </select>
    </div>
    
    <div class="form-group">
        <label>Игрушки до</label>
        <input type="number" name="toys_before" value="{{.Operation.ToysBefore}}" class="form-input">
    </div>
    
    <div class="form-group">
        <label>Игрушки после</label>
        <input type="number" name="toys_after" value="{{.Operation.ToysAfter}}" class="form-input">
    </div>
    
    <div class="form-group">
        <label>Добавлено игрушек</label>
        <input type="number" name="toys_added" value="{{.Operation.ToysAdded}}" class="form-input">
    </div>
    
    <div class="form-group">
        <label>Наличные до (₽)</label>
        <input type="number" step="0.01" name="cash_before" value="{{printf "%.2f" .Operation.CashBefore}}" class="form-input">
    </div>
    
    <div class="form-group">
        <label>Наличные после (₽)</label>
        <input type="number" step="0.01" name="cash_after" value="{{printf "%.2f" .Operation.CashAfter}}" class="form-input">
    </div>
    
    <div class="form-group">
        <label>Собрано наличных (₽)</label>
        <input type="number" step="0.01" name="cash_collected" value="{{printf "%.2f" .Operation.CashCollected}}" class="form-input">
    </div>
    
    <button type="submit" class="btn btn-primary">Сохранить</button>
    <button type="button" class="btn btn-secondary" onclick="hideModal()">Отмена</button>
</form>
{{ end }}